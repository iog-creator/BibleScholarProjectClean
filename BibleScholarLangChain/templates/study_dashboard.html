{% extends "base.html" %}

{% block title %}Study Dashboard - Bible Scholar{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2">
                    <i class="fas fa-tachometer-alt text-primary me-2"></i>
                    Study Dashboard
                </h1>
                <div class="text-muted">
                    <i class="fas fa-clock me-1"></i>
                    <span id="current-time"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Row -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">LM Studio</h4>
                            <p class="card-text" id="lm-status">Checking...</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-robot fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">API Server</h4>
                            <p class="card-text" id="api-status">Checking...</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-server fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">Database</h4>
                            <p class="card-text">Available</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-database fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">Features</h4>
                            <p class="card-text">5 Available</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-tools fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Features Grid -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-search me-2"></i>
                        Bible Study Tools
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <i class="fas fa-search fa-3x text-primary mb-3"></i>
                                    <h5 class="card-title">Bible Search</h5>
                                    <p class="card-text">Search through multiple Bible translations and find specific verses.</p>
                                    <a href="/search" class="btn btn-primary">
                                        <i class="fas fa-arrow-right me-1"></i>
                                        Start Search
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <i class="fas fa-lightbulb fa-3x text-warning mb-3"></i>
                                    <h5 class="card-title">Contextual Insights</h5>
                                    <p class="card-text">Get AI-powered insights and analysis for Bible verses and topics.</p>
                                    <a href="/contextual-insights" class="btn btn-warning">
                                        <i class="fas fa-arrow-right me-1"></i>
                                        Get Insights
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <i class="fas fa-graduation-cap fa-3x text-success mb-3"></i>
                                    <h5 class="card-title">Bible Tutor</h5>
                                    <p class="card-text">Interactive Bible study tutor for guided learning and exploration.</p>
                                    <a href="/tutor" class="btn btn-success">
                                        <i class="fas fa-arrow-right me-1"></i>
                                        Start Learning
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <i class="fas fa-cog fa-3x text-info mb-3"></i>
                                    <h5 class="card-title">LM Studio Test</h5>
                                    <p class="card-text">Test and configure your LM Studio AI integration settings.</p>
                                    <a href="/test-lm-studio" class="btn btn-info">
                                        <i class="fas fa-arrow-right me-1"></i>
                                        Test Connection
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-heartbeat me-2"></i>
                        System Status
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Web Application</span>
                            <span class="badge bg-success">Online</span>
                        </div>
                        <div class="progress" style="height: 5px;">
                            <div class="progress-bar bg-success" style="width: 100%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>LM Studio</span>
                            <span class="badge bg-primary" id="lm-badge">Checking...</span>
                        </div>
                        <div class="progress" style="height: 5px;">
                            <div class="progress-bar bg-primary" id="lm-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>API Server</span>
                            <span class="badge bg-warning" id="api-badge">Checking...</span>
                        </div>
                        <div class="progress" style="height: 5px;">
                            <div class="progress-bar bg-warning" id="api-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Quick Help
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item border-0 px-0">
                            <strong>Search:</strong> Use keywords or Bible references
                        </div>
                        <div class="list-group-item border-0 px-0">
                            <strong>Insights:</strong> Analyze verses or topics with AI
                        </div>
                        <div class="list-group-item border-0 px-0">
                            <strong>Tutor:</strong> Interactive Bible study sessions
                        </div>
                        <div class="list-group-item border-0 px-0">
                            <strong>Test:</strong> Verify LM Studio connection
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Update current time
function updateTime() {
    const now = new Date();
    document.getElementById('current-time').textContent = now.toLocaleString();
}

// Check system status
async function checkSystemStatus() {
    try {
        // Check health endpoint
        const response = await fetch('/health');
        const data = await response.json();
        
        // Update LM Studio status
        if (data.lm_studio_status === 'connected') {
            document.getElementById('lm-status').textContent = 'Connected';
            document.getElementById('lm-badge').textContent = 'Online';
            document.getElementById('lm-badge').className = 'badge bg-success';
            document.getElementById('lm-progress').style.width = '100%';
            document.getElementById('lm-progress').className = 'progress-bar bg-success';
        } else {
            document.getElementById('lm-status').textContent = 'Disconnected';
            document.getElementById('lm-badge').textContent = 'Offline';
            document.getElementById('lm-badge').className = 'badge bg-danger';
            document.getElementById('lm-progress').style.width = '0%';
        }
        
        // Update API status
        if (data.api_status === 'accessible') {
            document.getElementById('api-status').textContent = 'Connected';
            document.getElementById('api-badge').textContent = 'Online';
            document.getElementById('api-badge').className = 'badge bg-success';
            document.getElementById('api-progress').style.width = '100%';
            document.getElementById('api-progress').className = 'progress-bar bg-success';
        } else {
            document.getElementById('api-status').textContent = 'Not Available';
            document.getElementById('api-badge').textContent = 'Offline';
            document.getElementById('api-badge').className = 'badge bg-warning';
            document.getElementById('api-progress').style.width = '50%';
        }
        
    } catch (error) {
        console.error('Error checking system status:', error);
        document.getElementById('lm-status').textContent = 'Error';
        document.getElementById('api-status').textContent = 'Error';
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    updateTime();
    checkSystemStatus();
    
    // Update time every minute
    setInterval(updateTime, 60000);
    
    // Check status every 30 seconds
    setInterval(checkSystemStatus, 30000);
});
</script>
{% endblock %} 